<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="baidu-site-verification" content="jjKrmjBQYL" />



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.gmirror.org/css?family=Georgia:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="OM2M," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="提供参考的网站：

www.eclipse.org/om2m
https://iot.eclipse.org
论坛：http://www.eclipse.org/forums/eclipse.om2m[TOC]Om2m是一个横向的M2M（machine to machine）服务平台，目的是使得应用开发e和底层网络分离，适配各种异构设备。OM2M提供一些RESTful API来创建和管理M2M资源">
<meta property="og:type" content="article">
<meta property="og:title" content="OM2M调研">
<meta property="og:url" content="https://wanghansong.top/2017/OM2M调研.html">
<meta property="og:site_name" content="wanghansong's blog">
<meta property="og:description" content="提供参考的网站：

www.eclipse.org/om2m
https://iot.eclipse.org
论坛：http://www.eclipse.org/forums/eclipse.om2m[TOC]Om2m是一个横向的M2M（machine to machine）服务平台，目的是使得应用开发e和底层网络分离，适配各种异构设备。OM2M提供一些RESTful API来创建和管理M2M资源">
<meta property="og:image" content="http://i.imgur.com/QoMAgTz.png">
<meta property="og:image" content="http://i.imgur.com/vvynPeO.png">
<meta property="og:image" content="http://i.imgur.com/elpBlDj.png">
<meta property="og:image" content="http://i.imgur.com/DLlRyWc.png">
<meta property="og:image" content="http://i.imgur.com/J2MZYoC.png">
<meta property="og:image" content="http://onem2m.org/images/app_dev_guide/InitResourceCreation.png">
<meta property="og:image" content="http://onem2m.org/images/app_dev_guide/DiscCont.png">
<meta property="og:image" content="http://onem2m.org/images/app_dev_guide/DiscoveryRetrieval.png">
<meta property="og:image" content="http://onem2m.org/images/app_dev_guide/GroupDisc.png">
<meta property="og:image" content="http://onem2m.org/images/app_dev_guide/LightControl.png">
<meta property="og:image" content="http://onem2m.org/images/app_dev_guide/LightControlMul.png">
<meta property="og:updated_time" content="2020-07-25T05:06:38.144Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OM2M调研">
<meta name="twitter:description" content="提供参考的网站：

www.eclipse.org/om2m
https://iot.eclipse.org
论坛：http://www.eclipse.org/forums/eclipse.om2m[TOC]Om2m是一个横向的M2M（machine to machine）服务平台，目的是使得应用开发e和底层网络分离，适配各种异构设备。OM2M提供一些RESTful API来创建和管理M2M资源">
<meta name="twitter:image" content="http://i.imgur.com/QoMAgTz.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: '博主'
    }
  };
</script>

  <title> OM2M调研 | wanghansong's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?2a557223974248bf97d5421e8932cbcc";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">wanghansong's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">前端，后端，SDN，openflow</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于本人
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            所有文章
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-album">
          <a href="/album" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-image"></i> <br />
            
            相册
          </a>
        </li>
      
        
        <li class="menu-item menu-item-github">
          <a href="https://github.com/wanghansong" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-github"></i> <br />
            
            github
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                OM2M调研
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-05-02T15:22:18+08:00" content="2017-05-02">
              2017-05-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/杂七杂八/" itemprop="url" rel="index">
                    <span itemprop="name">杂七杂八</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/OM2M调研.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/OM2M调研.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-file-o"></i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>提供参考的网站：</p>
<ul>
<li>www.eclipse.org/om2m</li>
<li><a href="https://iot.eclipse.org" target="_blank" rel="external">https://iot.eclipse.org</a></li>
<li>论坛：<a href="http://www.eclipse.org/forums/eclipse.om2m" target="_blank" rel="external">http://www.eclipse.org/forums/eclipse.om2m</a><br>[TOC]<br>Om2m是一个横向的M2M（machine to machine）服务平台，目的是使得应用开发e和底层网络分离，适配各种异构设备。<br>OM2M提供一些RESTful API来创建和管理M2M资源。 它包括几个程序以实现机器认证，资源发现，应用程序注册，容器管理，同步和异步通信，访问权限授权，组织组织，重定向等</li>
</ul>
<a id="more"></a>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><p>This API operates on the following primary resource types:</p>
<ul>
<li><strong>CseBase（Common Services Entity）</strong>: describes the hosting CSE, and is the root for all other resources within the hosting CSE.(所有资源的根)</li>
<li>remoteCse: stores information related to M2M CSEs residing on other M2M machines after successful mutual authentication. It enables Cses interactions using retargeting operations（CSE业务之间交互）</li>
<li><strong>AE(Application Entity)</strong>: stores information about the Application Entity after a successful registration on the hosting CSE.（存应用实体信息）</li>
<li>Container: acts as a mediator for data buffering to enable data exchange between applications and CSEs（数据缓存中介容器）</li>
<li>AccessControlPolicies: manages permissions and permissions holders to limit and protect the access to the resource tree structure.（访问权限管理）</li>
<li>Group: enhances resources tree operations and simplifying the interactions on the API interfaces by adding the grouping feature. It enables an issuer to send one request to a set of receivers instead of sending requests one by one.（群发）</li>
<li>Subscription: stores information related to subscriptions for some resources. It allow subscribers to receive asynchronous notification when an event happens such as the reception of new sensor event or the creation, update, or delete of a resource.（通知）</li>
</ul>
<p>注：CSE(CommonchannelSignalingEquipment),公共信道信令设备.公共信道信令系统提供的几种可能的电信业务之一，用于某种特殊业务进行信息传递。</p>
<ul>
<li><strong>IN-CSE（Infrastructure Node CSE）</strong>:can be seen as a centralized server deployed on the cloud.</li>
<li><strong>MN-CSE (Middle Node CSE)</strong>:can be sees as a gateway deployed locally.</li>
</ul>
<blockquote>
<p>MNs has the possibility to register to IN and so enable one to obtain a highly distributed architecture covering various use cases.<br>You can consider an IoT architecture including only one IN if your prefer a centralized architecture, however this use case is not interesting because it requires that all your devices and applications are capable to reach the IN which is not the case for small sensors. The MN can act as a proxy to connect local constrained devices to the IN.<br>You can also consider an IoT architecture including only one MN deployed locally if you don’t need a centralized server, however this is not so recommended because it requires the MN to answer to all coming requests. In general, the MN is a constrained device which may represent a single point of failure in this case. Imagine a use case where your sensors are not deployed on the place which requires more than one MN. In this case, the IN will be the intermediate between all existing MNs.<br>For me, it is better to have a distributed IoT architecture including one IN and several MNs deployed in several places. The IN will be in charge to re-targeting requests from a Node to another in a seamless way. Applications can be deployed on the IN or on the MNs according to your needs. Each node can host customized services like cool dashboard in the IN, or dedicated interworking proxies in the MNs to connect local vendor-specific devices.</p>
</blockquote>
<ul>
<li><strong>Mca</strong> reference point is used to interface an AE and CSE</li>
<li><strong>Mcc</strong> reference point is used to interface CSEs</li>
<li>可以有多个IN-CSE</li>
<li>OM2M基于JAVA的OSGi框架开发</li>
</ul>
<h2 id="oneM2M架构"><a href="#oneM2M架构" class="headerlink" title="oneM2M架构"></a>oneM2M架构</h2><p><img src="http://i.imgur.com/QoMAgTz.png" alt="结构"></p>
<p><img src="http://i.imgur.com/vvynPeO.png" alt="结构图"></p>
<p><img src="http://i.imgur.com/elpBlDj.png" alt=""></p>
<h2 id="通信流程"><a href="#通信流程" class="headerlink" title="通信流程"></a>通信流程</h2><p><img src="http://i.imgur.com/DLlRyWc.png" alt="流程"></p>
<p>M2M通信有以下流程</p>
<ul>
<li>注册：灯应用实体、网关应用、数据资源的访问权限控制创建</li>
<li>资源初始化：包括分组资源创建、特定访问通道的容器资源创建、实例资源的创建（初始化灯状态）、subscription resources creation for notifications</li>
<li>容器发现：网关检测满足特定过滤条件的容器并将它们编入分组</li>
<li>发现和检索灯的状态：智能手机通过M2M服务平台使用资源认证的方式检索特定过滤条件的容器</li>
<li>控制灯的开关：</li>
</ul>
<p>上面流程的请求和响应都是通过oneM2M HTTP协议，使用XMXL和JSON传输数据.例如控制关灯的请求：<br>HTTP Request with XML payload<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">POST /home_gateway/light_ae1/light?rcn=0 HTTP/1.1</div><div class="line">Host: http://mn.provider.com:8080</div><div class="line">X-M2M-Origin: Clight_ae1</div><div class="line">Content-Type: application/vnd.onem2m-res+xml; ty=4</div><div class="line">X-M2M-RI: mncse-24345</div><div class="line"></div><div class="line">&lt;m2m:cin xmlns:m2m="http://www.onem2m.org/xml/protocols"&gt;</div><div class="line">  &lt;cnf&gt;text/plain:0&lt;/cnf&gt;</div><div class="line">  &lt;con&gt;OFF&lt;/con&gt;</div><div class="line">&lt;/m2m:cin&gt;</div></pre></td></tr></table></figure></p>
<p>HTTP Response</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">HTTP/<span class="number">1.1</span> <span class="number">201</span> Created</div><div class="line">   X-M2M-RSC: <span class="number">2001</span></div><div class="line">   X-M2M-RI: mncse-<span class="number">24345</span></div><div class="line">   Content-Location: /mn-cse/cin-<span class="number">394798749</span></div></pre></td></tr></table></figure>
<h3 id="注册流程"><a href="#注册流程" class="headerlink" title="注册流程"></a>注册流程</h3><p><img src="http://i.imgur.com/J2MZYoC.png" alt="通信流程"></p>
<h3 id="资源创建"><a href="#资源创建" class="headerlink" title="资源创建"></a>资源创建</h3><p>在MN-CSE中创建container，灯的状态存储在MN-CSE中</p>
<p><img src="http://onem2m.org/images/app_dev_guide/InitResourceCreation.png" alt="资源创建"></p>
<h3 id="容器发现"><a href="#容器发现" class="headerlink" title="容器发现"></a>容器发现</h3><p><img src="http://onem2m.org/images/app_dev_guide/DiscCont.png" alt="container discovery"></p>
<h3 id="Discovery-amp-Content-Instance-Retrieval"><a href="#Discovery-amp-Content-Instance-Retrieval" class="headerlink" title="Discovery &amp; Content Instance Retrieval"></a>Discovery &amp; Content Instance Retrieval</h3><p><img src="http://onem2m.org/images/app_dev_guide/DiscoveryRetrieval.png" alt="retrieval"><br>群容器：<br><img src="http://onem2m.org/images/app_dev_guide/GroupDisc.png" alt="群容器"></p>
<h3 id="light-control"><a href="#light-control" class="headerlink" title="light control"></a>light control</h3><p>控制单个灯状态：<br><img src="http://onem2m.org/images/app_dev_guide/LightControl.png" alt="单个"></p>
<p>群控制:<br><img src="http://onem2m.org/images/app_dev_guide/LightControlMul.png" alt="群控"></p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/OM2M/" rel="tag">#OM2M</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/PHP实用笔记.html" rel="next" title="PHP实用笔记">
                <i class="fa fa-chevron-left"></i> PHP实用笔记
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/OM2M安装.html" rel="prev" title="OM2M安装">
                OM2M安装 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNjExNC8xMjY0OQ=="></div>

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="王寒松" />
          <p class="site-author-name" itemprop="name">王寒松</p>
          <p class="site-description motion-element" itemprop="description">前端小白，JS,PHP</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">112</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">57</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://wpa.qq.com/msgrd?v=3&uin=614158750&site=qq&menu=yes" target="_blank" title="QQ">
                  
                    <i class="fa fa-fw fa-qq"></i>
                  
                  QQ
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/wanghansong" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情连接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="wanghansong.top" title="暂无" target="_blank">暂无</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#名词解释"><span class="nav-number">1.</span> <span class="nav-text">名词解释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#oneM2M架构"><span class="nav-number">2.</span> <span class="nav-text">oneM2M架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通信流程"><span class="nav-number">3.</span> <span class="nav-text">通信流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注册流程"><span class="nav-number">3.1.</span> <span class="nav-text">注册流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#资源创建"><span class="nav-number">3.2.</span> <span class="nav-text">资源创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#容器发现"><span class="nav-number">3.3.</span> <span class="nav-text">容器发现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Discovery-amp-Content-Instance-Retrieval"><span class="nav-number">3.4.</span> <span class="nav-text">Discovery & Content Instance Retrieval</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#light-control"><span class="nav-number">3.5.</span> <span class="nav-text">light control</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王寒松</span>&nbsp; | &nbsp; &nbsp;
  <span>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></span>
</div>



        

<div class="busuanzi-count">

  <script async src="http://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user">本站访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

    <script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
  </script>
  <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>

  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>

  
</body>
</html>
